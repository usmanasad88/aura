# AURA Configuration for Composite Layup Assistance Demo
# UR5 + Robotiq 2F-85 assisting with fiberglass hand layup

demo:
  name: "composite_layup"
  description: "Fiberglass hand layup assistance on mold"
  sop_file: "sops/composite_layup.json"

# Brain / Decision Engine
brain:
  model: "gemini-2.5-pro"
  temperature: 0.3
  max_tokens: 4096
  reasoning_style: "chain_of_thought"
  explanation_verbosity: "high"
  
  # Composite-specific decision parameters
  proactive_assistance: true
  anticipation_horizon_seconds: 10
  verbal_announcements: true
  
  # Safety overrides
  pause_on_human_proximity: true
  minimum_clearance_m: 0.15

# Perception Pipeline  
perception:
  camera:
    type: "realsense"
    model: "D435i"
    resolution: [1280, 720]
    fps: 30
  
  # Object detection for materials and tools
  object_detection:
    model: "yolov8m"
    confidence_threshold: 0.6
    classes:
      - "mixing_cup"
      - "resin_container"
      - "hardener_container"
      - "weigh_scale"
      - "roller"
      - "brush"
      - "squeegee"
      - "fiberglass_ply"
      - "mold"
      - "mixing_stick"
  
  # Defect detection for layup quality
  defect_detection:
    enabled: true
    model: "sam3"  # Segment Anything for defect segmentation
    defect_types:
      - "dry_spot"
      - "air_bubble"
      - "wrinkle"
      - "fiber_misalignment"
    min_defect_area_mm2: 25
    
  # Human pose for safety and intent
  human_pose:
    model: "rtmpose"
    track_hands: true
    track_gaze: true
    
  # Scale reading (OCR or direct interface)
  scale_reader:
    type: "vision_ocr"  # or "serial" for direct connection
    update_rate_hz: 5
    units: "grams"

# Sound Monitor
sound:
  enabled: true
  sample_rate: 16000
  
  # Voice command recognition
  wake_words: ["robot", "helper", "aura"]
  command_phrases:
    - "hand me the {tool}"
    - "more resin"
    - "check this area"
    - "pause"
    - "continue"
    - "emergency stop"
  
  # Speech synthesis for announcements
  tts:
    enabled: true
    voice: "en-US-Neural2-J"
    announcements:
      - "Resin measured: {weight} grams"
      - "Hardener measured: {weight} grams"
      - "Pot life warning: {minutes} minutes remaining"
      - "Defect detected: {type} at {location}"
      - "Ply {number} complete, ready for next"

# Motion Prediction
motion:
  enabled: true
  human_trajectory_model: "lstm"
  prediction_horizon_seconds: 2.0
  collision_check_frequency_hz: 20
  
  # Working envelope for layup task
  workspace_bounds:
    x_min: 0.1
    x_max: 0.7
    y_min: -0.4
    y_max: 0.5
    z_min: 0.0
    z_max: 0.6

# Intent Recognition
intent:
  enabled: true
  model: "gemini-2.0-flash"
  
  # Composite layup specific intents
  recognized_intents:
    - "request_tool"
    - "request_material"
    - "check_quality"
    - "need_resin"
    - "need_help"
    - "task_complete"
    - "pause_work"
    - "resume_work"
  
  # Context for better intent recognition
  task_context:
    current_step: null  # Updated dynamically
    tools_in_use: []
    time_since_last_resin_s: 0

# Affordance Detection
affordance:
  enabled: true
  
  # What robot can do in this task
  robot_affordances:
    - "grasp_container"
    - "pour_liquid"
    - "handoff_tool"
    - "observe_surface"
    - "point_at_location"
  
  # Grasp configurations for tools
  grasp_configs:
    mixing_cup:
      gripper_width_mm: 70
      approach: "top"
      grasp_force_n: 20
    resin_container:
      gripper_width_mm: 85
      approach: "side"
      grasp_force_n: 40
    hardener_container:
      gripper_width_mm: 60
      approach: "side"
      grasp_force_n: 30
    roller:
      gripper_width_mm: 30
      approach: "horizontal"
      grasp_force_n: 15
    brush:
      gripper_width_mm: 20
      approach: "horizontal"
      grasp_force_n: 10

# Performance Monitor
performance:
  enabled: true
  
  # Metrics specific to layup task
  metrics:
    - "pot_life_remaining_s"
    - "plies_completed"
    - "defects_detected"
    - "defects_resolved"
    - "resin_used_g"
    - "cycle_time_s"
    - "human_wait_time_s"
    - "robot_idle_time_s"
  
  # Alerts
  alerts:
    pot_life_warning_s: 1800   # 30 minutes
    pot_life_critical_s: 2400  # 40 minutes
    inter_ply_delay_warning_s: 300  # 5 minutes

# Robot Configuration
robot:
  type: "ur5"
  gripper: "robotiq_2f_85"
  controller: "ros2_control"
  
  # Connection settings
  connection:
    robot_ip: "192.168.1.102"
    use_fake_hardware: false
    
  # Speed and safety limits
  motion:
    max_velocity_scaling: 0.3
    max_acceleration_scaling: 0.3
    approach_velocity_scaling: 0.1  # Slow approach for handoffs
    
  # Predefined poses for this task
  named_poses:
    home:
      joint_values: [0, -1.57, 1.57, -1.57, -1.57, 0]
    observe_mold:
      joint_values: [-0.2, -1.2, 1.8, -2.2, -1.57, 0]
    prep_station:
      joint_values: [0.5, -1.4, 1.6, -1.8, -1.57, 0.5]
    tool_station:
      joint_values: [-0.3, -1.5, 1.5, -1.6, -1.57, -0.3]
    handoff_pose:
      joint_values: [0.1, -1.3, 1.4, -1.7, -1.57, 0.1]

# Visualization
visualization:
  rviz:
    enabled: true
    config: "config/rviz/composite_layup.rviz"
    markers:
      - "workspace_bounds"
      - "tool_locations"
      - "defect_highlights"
      - "human_tracking"
      - "scale_reading"
  
  dashboard:
    enabled: true
    show_metrics:
      - "pot_life_countdown"
      - "current_step"
      - "plies_completed"
      - "defects_count"
      - "resin_remaining"

# Logging
logging:
  level: "INFO"
  file: "logs/composite_layup_{timestamp}.log"
  
  # Record for training/analysis
  record:
    enabled: true
    video: true
    audio: true
    robot_state: true
    output_dir: "recordings/composite_layup"
  
  # Event logging for SOP analysis
  events:
    - "step_started"
    - "step_completed"
    - "defect_detected"
    - "defect_resolved"
    - "voice_command"
    - "robot_action"
    - "pot_life_warning"
